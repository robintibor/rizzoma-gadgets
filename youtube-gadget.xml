<?xml version="1.0" encoding="UTF-8" ?>
<Module>
<ModulePrefs
title="WaveTube"
height="120">
<Require feature="wave" />
<Require feature="dynamic-height" />
</ModulePrefs>
<Content type="html">
<![CDATA[
<style type="text/css">
button{border:1px solid #000;cursor:pointer;height:20px}.ui-widget{font-family:Verdana,Arial;font-size:1.1em}.ui-widget-content{border:1px solid #aaa;background:#eee 50% 50% repeat-x;color:#222}.ui-state-default,.ui-widget-content .ui-state-default{border:1px solid #d3d3d3;background:#fff 50% 50% repeat-x;font-weight:normal;color:#555;outline:none}.ui-corner-all{}.ui-slider{position:relative;text-align:left;margin-bottom:22px}.ui-slider .ui-slider-handle{position:absolute;z-index:4;width:30px;height:30px;cursor:default;text-align:center}.ui-slider-handle img{z-index:4}.ui-slider .ui-slider-range{position:absolute;z-index:1;font-size:.7em;display:block;border:0}.ui-slider-horizontal{height:.5em}.ui-slider-horizontal .ui-slider-handle{top:-.6em;margin-left:-.6em}.ui-slider-horizontal .ui-slider-range{top:0;height:100%}.ui-slider-horizontal .ui-slider-range-min{left:0}.ui-slider-horizontal .ui-slider-range-max{right:0}.status{float:left;width:12px;cursor:pointer;position:relative;top:-5px}.timepos,.timetot{font-family:Arial;font-size:11px}.progress{margin-left:20px;margin-right:22px;width:330px;float:left}.clocks{width:66px;float:left;position:relative;top:-6px}.annot-cont{display:none;position:relative;top:-60px;z-index:80}.annot{border:1px solid #C9C2C1;background:#FFFEE3;height:49px;max-width:140px;padding:3px;font-size:11px;font-family:Arial;overflow:hidden;z-index:90}.annot-tip{position:relative;left:15px;top:-1px;z-index:91;width:20px;height:10px;background:transparent url(data:image/gif;base64,R0lGODlhCwAHAPcAAAAAAMnCwf/+4wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH5BAEAAP8ALAAAAAALAAcAAAghAAUIHEhQQICCBAP8O4hQ4b+FBR0+hChQ4kSIFi8u1BgQADs%3D) no-repeat}.annot-bubble{display:none;cursor:pointer;float:left;width:23px;height:22px;background:transparent url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABcAAAAWCAYAAAArdgcFAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAAlwSFlzAAAC0QAAAtEBPz/oNwAAABl0RVh0U29mdHdhcmUAUGFpbnQuTkVUIHYzLjUuND6NzHYAAAJUSURBVEhLrZVNiFJRGIbv9W/CNBAnBNsIoiXlxnDhLBwyXLQpTBcDEoWrNgqBG0ECQYKhhSGuVHTpQiMIwsCICREmN7oZXIiCIS4yEBX/xqun90rCSDrM6D3wwr33nO/5zj3nO++hqfWNxue7SqXyudFoPNBoNPelUultHo/HH41GnXa73SoWi6fVavX7cDj8irHDDZzVzwCYbDZbLpVKMZ1Oh2xqDMOQUqlEfD5fU6VS+UG5eVkCAWZ4nE6nz6fT6Ubouo5Go0FcLtcZJmZYl0BkMpnS9Xr9WtCLg2ezGQkGg12RSPRoJYFOp3uH9dsafDHQ6/X+AfzeIgFN0w+SyeSIEzIg/X6fGAyGHNAiSq/Xf8COc8VecMLh8Dngh5TH4znjlAxYpVIhAoHgmAoEAl2u4WwJy2SyT5Tf7//NNbzVahGxWJyhnE7nCdfwQqFAUCjvKblc/rpWq3HKRzn2sKFP2Wq85Xa76/P5nJME7HnBen8Bd39R60Kh8DCRSOxc691ul5jN5jqQj1dOqUQieRaJRAasIW3Tms0msVqtvwA9gvj/eQxq86HD4fhZLpfJVZdpPB6TaDTKwBl/AMj6Cu9Sd+Tz+Ud2u/0kFouN2USTyWTlZ+DpJJfLsXbbV6vVLPQVJLuSp/8bxF4Yd3BJfMzn8wv4YDAg8XicgXeU0fcG0kE3rgNdjqVxE3mz2SzT6/VIKBSaarXaU3S+hOTbAJcxPFwcwUwmM4dHj5DkGzrskHQXKBuLfRWELRZLT6FQfMb7E0i8K3QZ/wIPb6EDaG8X6F+inrC0jv1r5AAAAABJRU5ErkJggg%3D%3D) no-repeat;position:relative;top:-6px;margin-right:4px}#annotform{display:none;position:absolute;border:1px solid #000;background:#FFFEE3;padding:4px;width:248px;height:65px;z-index:99}#annotform button{font-size:11px}.annot-form-input{float:left;font-size:11px;margin-right:10px;margin-bottom:7px}.annot-form-input input,select{height:20px;font-size:12px}#errormsg{display:none;font-size:11px;color:red}#maincont{display:none;padding:7px}#sliders{display:none;margin-top:6px;margin-left:2px}#helpbar{display:none;text-align:right;font-size:10px;font-family:Arial}#yturlInput{width:300px;height:20px;font-style:italic}#initial{display:none;font-size:12px;font-family:Arial;background:#C9E2FC;padding-left:6px;margin-bottom:3px;border-bottom:1px solid #7992BC;padding-top:2px;padding-bottom:2px}#urlcont{margin-right:3px;margin-top:3px}#loadlbl{display:none;font-size:12px;font-family:Arial;color:#333}#settings{list-style-type:none;padding-left:30px;margin-top:7px;font-size:11px}#settings li{padding-bottom:4px}#settings select{width:80px}.settingsTitle{float:left;padding-top:3px;width:97px}#helpbarform{width:90px;float:left;text-align:right;font-size:11px;padding:2px}.mark{width:3px;height:100%;background:none repeat scroll 0% 0% rgb(204,136,136);position:absolute;z-index:3;top:0px}#note{display:none;font-size:12px;font-family:Arial;width:400px;padding-top:8px}
</style>
<script src="https://www.google.com/jsapi"></script>
<script type="text/javascript">google.load("jquery", "1.3.2");google.load("jqueryui", "1.7.2");google.load("swfobject", "2.1");
var a;S1=500;S2=80;S3=0.5;IH="https://everybodywave.appspot.com/gadget/WaveTube/";P1=gadgets.io.getProxyUrl(IH+"play.png");P2=gadgets.io.getProxyUrl(IH+"pause.png");SliderStatus={PAUSE:0,PLAY:1};SliderStatusImg=new Array(P1,P2);var _sls=[];
function PlayerSlider(b,c,d,f,e,g,j){this.contId=b;this.partId=c;this.id=getSliderIdByUserId(c);this.part=wave.getParticipantById(c);this.duration=parseInt(d,10);this.onMoveCB=f;this.onChangeCB=e;this.onStatusChangeCD=g;this.onAnnotationAddCD=j;this.poller=null;this.lastVal=this.pollerStage=0;this.status=null;this.sliderWidth=330;this.annotationTimer=null;this.sliderlock=false;_sls.push(this)}a=PlayerSlider.prototype;
a.build=function(){if(this.part){var b=this.part.getDisplayName(),c=this.part.getThumbnailUrl();$("#"+this.contId).append("<div id='"+this.id+"'></div>");$("#"+this.id).append("<div class='status'><img width=20 height=20 src='' /></div><div class='progress'></div><div class='clocks'><span class='timepos'>0:00</span> / <span class='timetot'>"+secsToTime(this.duration)+"</span></div><div class='annot-bubble' title='Click to add a note'></div><div style='clear: both;'></div>").find(".progress").css("width",
this.sliderWidth+"px").html("<div class='ui-slider-handle'><img width=30 height=30 /></div><div class='annot-cont'><div class='annot'></div><div class='annot-tip'></div></div>").slider({min:0,max:Math.round(this.duration),change:onChangeCallbackbridge}).find("img").attr("src",c).attr("title",b);$("#"+this.id).find(".annot-bubble").click(onAnnotationBubbleClicked)}};
a.setVal=function(b){if(!this.sliderlock){this.lastVal=b;$("#"+this.id).find(".progress").slider("option","value",Math.round(b));$("#"+this.id).find(".timepos").html(secsToTime(b));this.onMoveCB(this,b)}};a.setStatus=function(b){this.endPoller();if(b==SliderStatus.PLAY)this.poller=setInterval("pollSlider('"+this.id+"')",S1);if(this.status!=b){$("#"+this.id).find(".status").find("img").attr("src",SliderStatusImg[b]).click(onChangeStatusCallbackBridge);this.status=b}};
a.endPoller=function(){if(this.poller){clearInterval(this.poller);this.poller=null;this.pollerStage=0}};a.showAnnotation=function(b,c){var d=_getAnnotPos(this,b);$("#"+this.id).find(".progress").find(".annot-cont").css("left",d-20+"px").show().find(".annot").text(b.caption);if(!c){this.annotationTimer&&clearTimeout(this.annotationTimer);this.annotationTimer=setTimeout("_hideAnnot('"+this.id+"')",b.duration*1E3)}};
a.addAnnotationMark=function(b){var c=_getAnnotPos(this,b),d=$("#"+this.id).find(".progress");d.find("#mark"+b.id).length==0&&d.append('<div class="mark" sliderid="'+this.id+'" annid="'+b.id+'" id="mark'+b.id+'"></div>').find("#mark"+b.id).css("left",c+"px").mouseenter(function(){onAnnotationHoverOn($(this).attr("sliderid"),$(this).attr("annid"))})};a.showBubble=function(){$("#"+this.id).find(".annot-bubble").show()};a.hideBubble=function(){$("#"+this.id).find(".annot-bubble").hide()};
a.updateProfile=function(b,c){$("#"+this.id).find(".progress").find("img").attr("src",c).attr("title",b)};function getSliderIdByUserId(b){return base64en(b)}function pollSlider(b){b=searchSliderById(b);if(b.poller&&b.pollerStage<S2&&b.lastVal<b.duration){b.setVal(parseFloat(b.lastVal)+S3);b.pollerStage++}else b.endPoller()}function searchSliderById(b){for(var c=null,d=0;c==null&&d<_sls.length;){if(_sls[d].id==b)c=_sls[d];d++}return c}
function onChangeCallbackbridge(b,c){this.sliderlock=true;var d=$(c.handle).parent().parent().attr("id");if((d=searchSliderById(d))&&d.onChangeCB){d.endPoller();d.lastVal=parseInt(c.value,10);d.onChangeCB(d,c.value)}this.sliderlock=false}function onChangeStatusCallbackBridge(b){b=$(b.target).parent().parent().attr("id");(b=searchSliderById(b))&&b.onStatusChangeCD&&b.onStatusChangeCD(b)}
function onAnnotationBubbleClicked(b){var c=$(b.target).parent().attr("id");(c=searchSliderById(c))&&c.onAnnotationAddCD&&c.onAnnotationAddCD(c,b)}function searchSliderByUserId(b){return searchSliderById(getSliderIdByUserId(b))}function _hideAnnot(b){$("#"+b).find(".progress").find(".annot-cont").hide()}function rereadSliderProfiles(){for(var b=0;b<_sls.length;b++){var c=_sls[b],d=wave.getParticipantById(c.partId);d&&c.updateProfile(d.getDisplayName(),d.getThumbnailUrl())}}
function _getAnnotPos(b,c){return Math.round(parseFloat(c.showTime)/parseFloat(b.duration)*b.sliderWidth)}function secsToTime(b){var c=Math.round(b);b=Math.floor(c/60);c=Math.floor(c%60);if(c<10)c="0"+c;return b+":"+c}function timeToSecs(b){var c=null;te=b.split(":");if(te.length==2)c=parseInt(te[0],10)*60+parseInt(te[1],10);else if(te.length==3)c=parseInt(te[0],10)*3600+parseInt(te[1],10)*60+parseInt(te[2],10);return c}var _base64cache={};
function base64en(b){if(_base64cache[b]!=undefined)return _base64cache[b];else{KS="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_@-";for(var c="",d,f,e,g,j,h,i=0;i<b.length;){d=b.charCodeAt(i++);f=b.charCodeAt(i++);e=b.charCodeAt(i++);g=d>>2;d=(d&3)<<4|f>>4;j=(f&15)<<2|e>>6;h=e&63;if(isNaN(f))j=h=64;else if(isNaN(e))h=64;c=c+KS.charAt(g)+KS.charAt(d)+KS.charAt(j)+KS.charAt(h)}return c}}PS={UNSTARTED:-1,END:0,PLAYING:1,PAUSED:2,BUFFERING:3,CUED:5};PlayerUrl="https://www.youtube.com/v/";
PID="ytPlayer";__playerSinglton=null;function WaveTubePlayer(b,c,d){this.videoId=null;this.containerId=b;this.PID=PID;this.width=c;this.height=d;this.playState=null;this.isLoaded=false;this.onPlayerError=this.onPlayerStateChangedCallback=this.onPlayerLoaded=this.updateStateTimer=this.playerHandle=null;__playerSinglton=this}a=WaveTubePlayer.prototype;
a.loadPlayerByYTUrl=function(b){(b+"&").match(/v=(.+?)&/g);(this.videoId=RegExp.$1)&&swfobject.embedSWF(PlayerUrl+this.videoId+"?enablejsapi=1&playerapiid=player1&version=3",this.containerId,this.width,this.height,"8",null,null,{allowScriptAccess:"always",wmode:"transparent"},{id:this.PID})};
a.seek=function(b){if(this.playState==PS.PLAYING||this.playState==PS.BUFFERING)this.playerHandle.seekTo(b,true);else if(this.playState==PS.CUED||this.playState==PS.PAUSED||this.playState==PS.END){this.playerHandle.playVideo();this.playerHandle.seekTo(b,true)}};
a.onYouTubeLoads=function(){this.isLoaded=true;this.playerHandle=document.getElementById(this.PID);this.playerHandle.addEventListener("onStateChange","onPlayerStateChangedBridge");this.playerHandle.addEventListener("onError","onPlayerErrorBridge");this.onPlayerLoaded()};a.onPlayerStateChanged=function(b){this.playState=b;this.onPlayerStateChangedCallback(false);if(this.updateStateTimer==null)this.updateStateTimer=setTimeout("onStateChangeTimerDoneBridge()",1E3)};
a.onStateChangeTimerDone=function(){this.onPlayerStateChangedCallback(true);this.updateStateTimer=null};a.remove=function(){$("#"+PID).remove()};a.play=function(){this.playerHandle.playVideo()};a.pause=function(){this.playerHandle.pauseVideo()};a.getCurrentTime=function(){return this.playerHandle.getCurrentTime()};a.getDuration=function(){return this.playerHandle.getDuration()};function onYouTubePlayerReady(){__playerSinglton&&__playerSinglton.onYouTubeLoads()}
function onPlayerStateChangedBridge(b){__playerSinglton&&__playerSinglton.onPlayerStateChanged(b)}function onPlayerErrorBridge(b){__playerSinglton&&__playerSinglton.onPlayerError(b)}function onStateChangeTimerDoneBridge(){__playerSinglton&&__playerSinglton.onStateChangeTimerDone()}
function Annotation(b,c){this.id=b;this.duration=this.showTime=0;this.parentId=c;this.caption=this.creatorName=null;this.getUniqueKey=function(){return"an^"+this.id+"^"+this.parentId};this.toJSON=function(){return{st:this.showTime,d:this.duration,cr:this.creatorName,cp:this.caption}};this.fromJSON=function(d){this.showTime=parseInt(d.st);this.duration=parseInt(d.d);this.creatorName=d.cr;this.caption=d.cp};this.isEqualJSON=function(d){return this.showTime==d.st&&this.duration==d.d&&this.creatorName==
d.cr&&this.caption==d.cp}}function AnnotateModel(){this.nextId=0;this.data={};this.lookup=[]}a=AnnotateModel.prototype;a.create=function(b){this.nextId++;return new Annotation(this.nextId,b)};a.save=function(b){this.data[b.getUniqueKey()]=b.toJSON();this.lookup[b.showTime]||(this.lookup[b.showTime]=[]);this.lookup[b.showTime].push(new Array(b.parentId,b))};a.remove=function(b){b=b.getUniqueKey();this.data[b]=null;wave.getState().submitValue(b,null)};
a.isChanged=function(b){var c=this.data[b.getUniqueKey()];return!c||b.isEqualJSON(c)};a.getAnnotationByKey=function(b){var c=b.split("^");c=new Annotation(c[1],c[2]);c.fromJSON(this.data[b]);return c};a.loadFromWave=function(){this.data=stateToAssocJson(wave.getState(),/an\^/);this.nextId=maxKeyIdx;this.lookup.length=0;var b;for(key in this.data){b=this.getAnnotationByKey(key);this.lookup[b.showTime]||(this.lookup[b.showTime]=[]);this.lookup[b.showTime].push(new Array(b.parentId,b))}};
a.syncWithWave=function(){assocJsonToState(this.data,wave.getState())};a.reset=function(){this.nextId=0;this.data={};this.lookup={}};a.iterate=function(b){var c;for(key in this.data){c=this.getAnnotationByKey(key);b(c)}};a.searchAnnotationByParentId=function(b,c){return this.getAnnotationByKey((new Annotation(c,b)).getUniqueKey())};var sortIndex=0,k1v,k2v,maxIndex=1,maxKeyIdx;
function stateOrder(b,c){k1v=wave.getState().get(b).split(" ")[sortIndex].split(":")[1];k2v=wave.getState().get(c).split(" ")[sortIndex].split(":")[1];return k1v&&k2v&&parseInt(k1v)>parseInt(k2v)?1:-1}function assocJsonToState(b,c){var d={},f,e;for(json in b){f="";e=b[json];for(k in e)f+=" "+escape(k)+":"+escape(e[k]);d[json]=f.substring(1)}c.submitDelta(d)}
function stateToAssocJson(b,c){maxKeyIdx=0;var d={},f=b.getKeys(),e,g,j,h,i,l;f.sort(stateOrder);for(i=0;i<f.length;i++){e=f[i];if(e.match(c)){g=b.get(e);j=g.split(" ");l={};for(h=0;h<j.length;h++){g=j[h].split(":");key=unescape(g[0]);val=unescape(g[1]);l[key]=val}d[e]=l;e=parseInt(e.split("^")[maxIndex]);if(e>maxKeyIdx)maxKeyIdx=e}}return d}VER="0.5";STATE_SYNC_TIME=4E4;MAX_AGE_DEFAULT=864E5;STATE_LATENCY_COMPENSATION=0.1;PLAY_STATUS_MAX_AGE=18E5;LOAD_TIMEOUT_MS=5E3;DEFAULT_PLAYER_WIDTH=480;
DEFAULT_PLAYER_HEIGHT=295;var rendered=false,player=null,stateCache=[],curHeight=100,annotationModel=null,slider_max_age=MAX_AGE_DEFAULT,loadTimeout=null,lastUpdatedPos=0;function init(){wave.setStateCallback(onStateChange);wave.setParticipantCallback(onParticipantChange);$("#annotbtn").click(onAnnotBtnClick);$("#annotcap").keypress(function(b){b&&b.keyCode==13&&onAnnotBtnClick()});$("#annotcancel").click(function(){$("#annotform").hide()})}
function onStateChange(){var b=wave.getState(),c=b.get("yturl");if(!player||!player.isLoaded)if(c){var d=b.get("set:maxage");if(d&&!isNaN(d))slider_max_age=d;d=b.get("set:size");b=DEFAULT_PLAYER_WIDTH;var f=DEFAULT_PLAYER_HEIGHT;if(d){d=d.split("x");b=parseInt(d[0]);f=parseInt(d[1])}$("#maincont").show();player&&player.remove();$("#maincont").prepend("<div id='videoDiv'></div>");player=new WaveTubePlayer("videoDiv",b,f);player.loadPlayerByYTUrl(c);player.onPlayerLoaded=onPlayerLoaded;player.onPlayerStateChangedCallback=
onPlayerStateChange;player.onPlayerError=onPlayerError}else displayInitialForm();annotationModel=annotationModel||new AnnotateModel;annotationModel.loadFromWave();if(player&&player.isLoaded){buildSlidersFromState();markAnnotations()}searchSliderByUserId(wave.getViewer().getId())==null&&$("#note").show();rendered=true}function onParticipantChange(){rendered&&rereadSliderProfiles()}
function buildSlidersFromState(){for(var b=wave.getState(),c=b.getKeys(),d=0;d<c.length;d++){var f=c[d],e=f.split("_")[1];if(e){var g=b.get(f).split("~");f=parseInt(g[0])+STATE_LATENCY_COMPENSATION;var j=g[1],h=g[2],i=g[3];g=g[4];var l=(new Date).getTime()-g;if((slider_max_age==-1||l<slider_max_age)&&(!stateCache[e]||g!=stateCache[e])){stateCache[e]=g;if(l>PLAY_STATUS_MAX_AGE)h=SliderStatus.PAUSE;updateUserSlider(e,f,j,h);i&&e==wave.getViewer().getId()&&i!=wave.getViewer().getId()&&h==SliderStatus.PLAY&&
wave.getMode()!=wave.Mode.PLAYBACK&&player.seek(f)}}}}function markAnnotations(){annotationModel.iterate(function(b){var c=searchSliderById(b.parentId);c&&c.addAnnotationMark(b)})}function onPlayerLoaded(){clearTimeout(loadTimeout);loadTimeout=null;buildSlidersFromState();markAnnotations();setInterval(onSyncWithState,STATE_SYNC_TIME);onSyncWithState();$("#initial").hide();curHeight+=player.height-5;gadgets.window.adjustHeight(curHeight);$("#helpbar").css("width",player.width+"px").show()}
function onPlayerStateChange(b){var c=wave.getViewer().getId(),d=searchSliderByUserId(c);if(d){var f=null;f=player.playState==PS.PLAYING||player.playState==PS.BUFFERING?SliderStatus.PLAY:SliderStatus.PAUSE;d.setStatus(f);if(player.playState!=PS.UNSTARTED&&player.playState!=PS.CUED){var e=player.getCurrentTime();b&&Math.abs(lastUpdatedPos-e)>1?updateUserPos(c,e,f):d.setVal(e)}}else player.playState!=PS.UNSTARTED&&player.playState!=PS.CUED&&updateUserPos(c,0,SliderStatus.PLAY)}
function onPlayerError(b){wave.log("Player Error: "+b)}function onSliderMove(b,c){if(b.partId==wave.getViewer().getId()){var d=0,f,e,g=annotationModel.lookup[Math.round(c)];if(g)for(d=0;d<g.length;d++){f=g[d][0];e=g[d][1];(b=searchSliderById(f))&&b.showAnnotation(e)}}}function onSliderChange(b,c){if(b.partId==wave.getViewer().getId())player.isLoaded&&player.seek(c);else updateUserPos(b.partId,c,SliderStatus.PLAY)}
function onSliderStatusChange(b){updateUserPos(b.partId,b.lastVal,b.status==SliderStatus.PAUSE?SliderStatus.PLAY:SliderStatus.PAUSE)}function onSyncWithState(){player.isLoaded&&player.getDuration()>0&&player.playState==PS.PLAYING&&updateUserPos(wave.getViewer().getId(),player.getCurrentTime(),SliderStatus.PLAY)}
function onAnnotBubbleClick(b,c){$("#errormsg").hide();$("#annotwhen").val(secsToTime(b.lastVal));$("#annotform").css("top",c.clientY+16+"px").css("left",c.clientX-245+"px").slideDown(100);$("#annotcap").focus()}
function onAnnotBtnClick(){var b=wave.getViewer().getId(),c=timeToSecs($("#annotwhen").val()),d=$("#annotcap").val();if(c!=null&&!isNaN(c)&&player.isLoaded&&c<player.getDuration()&&d.length>0){b=annotationModel.create(getSliderIdByUserId(b));b.showTime=c;b.duration=$("#annotduration").val()||5;b.creatorName=wave.getViewer().getDisplayName();b.caption=d;$("#annotform").hide();annotationModel.save(b);annotationModel.syncWithWave()}else $("#errormsg").show()}
function onAnnotationHoverOn(b,c){var d=searchSliderById(b),f=annotationModel.searchAnnotationByParentId(b,c);d&&f&&d.showAnnotation(f)}function updateUserPos(b,c,d){var f=wave.getState();b="u_"+b;var e=(new Date).getTime();f.submitValue(b,c+"~"+player.getDuration()+"~"+d+"~"+wave.getViewer().getId()+"~"+e);lastUpdatedPos=c}
function updateUserSlider(b,c,d,f){var e=searchSliderByUserId(b);if(e==null){e=new PlayerSlider("sliders",b,d,onSliderMove,onSliderChange,onSliderStatusChange,onAnnotBubbleClick);e.build();if($("#sliders").css("display")=="none"){curHeight+=50;$("#sliders").show()}curHeight+=33;gadgets.window.adjustHeight(curHeight)}if(b==wave.getViewer().getId()){$("#note").hide();e.showBubble();if(f==SliderStatus.PLAY&&player.playState!=PS.PLAYING&&wave.getMode()!=wave.Mode.PLAYBACK)player.play();else if(f==SliderStatus.PAUSE&&
(player.playState==PS.PLAYING||player.playState==PS.BUFFERING))player.pause();Math.abs(player.getCurrentTime()-c)<2&&e.setVal(player.getCurrentTime())}else e.setVal(c);e.setStatus(f)}
function displayInitialForm(){var b=wave.getState();$("#initial").show();$("#yturlGo").click(function(){var c=$.trim($("#yturlInput").val());if(c.length>0){$("#loadlbl").text("Loading player...").show();b.submitDelta({yturl:c,"set:maxage":$("#maxage").val(),"set:size":$("#vsize").val()});loadTimeout=setTimeout("onLoadFailed()",LOAD_TIMEOUT_MS)}});$("#yturlInput").focus(function(){$(this).attr("init")=="1"&&$(this).attr("init","0").val("").css("font-style","normal")})}
function onLoadFailed(){if(loadTimeout!=null){$("#loadlbl").text("Error: Failed to load player").show();wave.getState().reset()}}gadgets.util.registerOnLoadHandler(init);
</script>
<div id="initial"> 
<div id="urlcont">URL&nbsp; <input id="yturlInput" type="text" value="Enter a full YouTube URL here" init="1"></div> 
<ul id="settings">
<li><div class="settingsTitle">Video Dimensions:</div> 
<div style="float:left">
<select id="vsize"><option value="480x295" selected>480x295</option><option value="640x385">640x285</option><option value="853x505">853x505</option>
</select>
</div><div style="clear:both"></div></li>
<li><div class="settingsTitle">Max idle time:</div>
<div style="float:left">
<select id="maxage">
<option value="3600000">1 Hour</option><option value="43100000">12 Hours</option><option value="86400000" selected>24 Hours</option><option value="-1">Forever</option>
</select>
</div><div style="clear:both"></div></li>
</ul>
<div style="float:left;width:240px"><button id="yturlGo">Go</button>&nbsp;<span id="loadlbl"></span></div>
<div id="helpbarform"><a href="https://everybodywave.appspot.com/index/wavetube.html" target="_blank">Help</a> | <a href="https://wave.google.com/wave/#restored:wave:googlewave.com!w%252BalFptV0sA" target="_blank">Install</a> 
</div>
<div style="clear:both"></div>
</div>
<div id="maincont">
<div id="note"><b>Note:</b> WaveTube is a <em>collaborative</em> YouTube player for Google Wave. When you start playing the video, your current playback position will be shared with the rest of the users on the wave.</div>
<div id='sliders'><h4>Who's watching:</h4></div>
<div id="annotform">
<div class="annot-form-input">&nbsp;At<br /><input style="width:55px" id="annotwhen" /></div>
<div class="annot-form-input">&nbsp;Text<br /><input maxlength=60 style="width:120px" id="annotcap" /></div>
<div class="annot-form-input" style="margin-right:0 !important;">&nbsp;Duration<br>
<select style="width:46px" id="annotduration">
<option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="5" selected>5</option><option value="7">7</option><option value="10">10</option>
</select>
</div>
<div style="clear:both;text-align:right;margin-right:5px;">
<span id="errormsg">Error in input</span>
<button id="annotbtn">OK</button>
<button id="annotcancel">Cancel</button>
</div>
</div>
<div id='helpbar' ><a href="https://everybodywave.appspot.com/index/wavetube.html" target='_blank'>about</a> | <a href="https://wave.google.com/wave/#restored:wave:googlewave.com!w%252Bh2RZJhpEA" target='_blank'>install</a></div>
</div>
<script type="text/javascript">
var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "https://www.");document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
</script>
<script type="text/javascript">try {var pageTracker=_gat._getTracker("UA-12309529-1");pageTracker._trackPageview()} catch(err){}</script>
]]>
</Content>
</Module>
